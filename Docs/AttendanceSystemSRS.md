## وثيقة متطلبات نظام إدارة الدوام والموظفين (SRS)

### 1. المقدمة
- **الغرض**: تحديد المتطلبات الوظيفية وغير الوظيفية لنظام مركزي لإدارة حضور موظفي المؤسسة، يشمل تسجيل الحضور والانصراف، احتساب التأخير والإضافي والزمنيات، مع دعم التقارير ولوحات القيادة.
- **نطاق النظام**: نظام ويب يعتمد على طبقات (Entities / Services / Repositories / Controllers) ويقدّم واجهات استخدام للموظفين والمديرين، إضافة إلى واجهات برمجية (REST APIs) محمية بـ JWT.
- **تعريفات مختصرة**:  
  - **الزمنية**: رصيد ساعات يمكن للموظف استخدامها لتغطية التأخير.  
  - **رصيد الـ90 دقيقة**: أول 90 دقيقة تأخير ضمن الشهر تُخصم من الرصيد بدلاً من احتسابها كتأخير فعلي.

### 2. أصحاب العلاقة (Stakeholders)
| الدور | الوصف |
|-------|-------|
| مدير النظام (Admin) | يملك جميع الصلاحيات: إدارة الموظفين، ضبط الإعدادات، الاطلاع على الإحصائيات والتقارير وإعادة حساب الأشهر. |
| الموظف (Employee) | يسجّل حضوره اليومي، يعدّل يومه الحالي، ويطّلع على ملخصه الشهري فقط. |

### 3. صلاحيات المستخدمين (User Roles)
#### 3.1 صلاحيات المدير
- CRUD للموظفين (إضافة، تعديل، تعطيل، حذف منطقي).
- إعادة تعيين كلمات المرور وإدارة الأدوار.
- عرض وتقارير شهرية عن جميع الموظفين وتصديرها (Excel/PDF).
- رؤية المؤشرات: مجموع التأخير، مجموع الإضافي، الزمنيات المستعملة، ترتيب الالتزام، الموظفون الأكثر التزامًا، وأكثر الموظفين تأخرًا.
- إعادة حساب شهر كامل لأي موظف.
- ضبط إعدادات النظام: أوقات الدوام، رصيد الزمنيات الشهري، رصيد الـ90 دقيقة.

#### 3.2 صلاحيات الموظف
- تسجيل الدخول باسم المستخدم وكلمة المرور (JWT).
- إدخال أوقات الدخول والخروج والزمنية (عند الحاجة) لليوم الحالي فقط.
- متابعة ملخص الشهر، الأيام المسجّلة، المتبقي من الزمنيات والـ90 دقيقة، مجموع الإضافي والتأخير.
- لا يرى بيانات موظفين آخرين.

### 4. متطلبات المصادقة (Authentication)
- المصادقة عبر `Username + Password` تُصدر JWT.
- جميع واجهات API محمية ما عدا `/auth/login`.
- كلمات المرور تُشفّر باستخدام BCrypt.

### 5. المتطلبات الوظيفية (Functional Requirements)
#### 5.1 إدارة الموظفين (Admin)
- **FR1**: إضافة موظف جديد (اسم كامل، اسم مستخدم، كلمة مرور، الوظيفة اختياري).
- **FR2**: تعطيل موظف لمنعه من تسجيل الدخول.
- **FR3**: تعديل بيانات الموظف.
- **FR4**: حذف منطقي للموظف مع الحفاظ على السجلات.
- **FR5**: استعراض قائمة الموظفين وحالاتهم (فعال، معطل، محذوف).

#### 5.2 تسجيل الدوام اليومي (Employee)
- **FR6**: تسجيل يوم يحتوي التاريخ، وقت الدخول، وقت الخروج، والزمنية المستخدمة (اختيارية).
- **FR7**: النظام يحسب تلقائيًا التأخير، الإضافي، الزمنية المستعملة، الخصم من رصيد الـ90 دقيقة، ويحدّث `MonthlySummary`.
- **FR8**: في حال غياب وقت الخروج يُفترض 14:00 كوقت افتراضي.
- **FR9**: يمكن للموظف تعديل يومه الحالي فقط.

#### 5.3 ملخص الشهر
- **FR10**: الاحتفاظ بملخص شهري يتضمن مجموع الزمنيات، مجموع التأخير، خصم الـ90 دقيقة، المتبقي من الزمنيات ومن الـ90 دقيقة، مجموع الإضافي.
- **FR11**: المدير يعرض ملخص أي موظف.
- **FR12**: الموظف يعرض ملخصه فقط.

#### 5.4 إحصائيات الإدارة
- **FR13**: لوحة تحكم لعرض عدد الموظفين، ترتيب حسب التأخير والالتزام، مجموع التأخير، مجموع الزمنيات، مجموع الإضافي لآخر شهر.
- **FR14**: المدير يعيد حساب شهر كامل لموظف عند الحاجة.

### 6. قواعد العمل (Business Rules)
1. الدوام الرسمي 07:00 حتى 14:00.
2. التأخير = (وقت الدخول - 07:00) إذا كان موجبًا.
3. الإضافي = (وقت الخروج - 14:00) إذا كان موجبًا.
4. الحد الأعلى للزمنية اليومية 240 دقيقة.
5. رصيد الزمنيات الشهري 420 دقيقة.
6. أول 90 دقيقة تأخير تخصم من الرصيد، بعدها تُسجّل كتأخير فعلي.
7. الجمعة والسبت عطلة ولا يمكن تسجيل دوام فيهما.
8. لا يمكن تسجيل أكثر من سجل حضور لليوم نفسه لكل موظف.

### 7. المتطلبات غير الوظيفية (Non-Functional)
- **الأداء**: زمن استجابة ≤ 200ms للطلبات القياسية، ودعم 100k سجل حضور دون تأثير جوهري.
- **الأمن**: تشفير كلمات المرور، حماية JWT، حماية من SQL Injection وXSS، آلية قفل بعد محاولات فاشلة متعددة.
- **الاعتمادية**: قابلية التوسع ودعم النسخ الاحتياطي الدوري.
- **سهولة الاستخدام**: واجهة موظف مبسّطة، ولوحة تحكم غنية بالإحصائيات والرسوم.
- **قابلية التطوير**: فصل الطبقات (Entities, DTO, Services, IServices, Repositories, Controllers) مع قابلية دعم واجهات Flutter / React.

### 8. سيناريوهات الاستخدام (Use Cases)
- **UC1 – Admin Login**: يدخل بياناته → يحصل على JWT → ينتقل للوحة التحكم.
- **UC2 – Add Employee**: يفتح نموذج الإضافة → يعبّئ البيانات → النظام يحفظ الموظف → تظهر رسالة نجاح.
- **UC3 – Employee Attendance Record**: يسجل الدخول → يدخل التاريخ والأوقات والزمنية → النظام يحسب المتغيرات ويحدّث الملخص → يرجع النتيجة.
- **UC4 – View Monthly Summary**: الموظف يشاهد ملخصه، والمدير يستطيع اختيار أي موظف واستعراض ملخصه.

### 9. واجهات الـ API
#### Authentication
| Method | Endpoint | الوصف |
|--------|----------|-------|
| POST | /auth/login | تسجيل الدخول |
| POST | /auth/refresh | تجديد التوكن |

#### Employees (Admin Only)
| Method | Endpoint | الوصف |
|--------|----------|-------|
| GET | /api/employees | جلب كل الموظفين |
| POST | /api/employees | إضافة موظف |
| PUT | /api/employees/{id} | تعديل موظف |
| DELETE | /api/employees/{id} | حذف موظف (Soft Delete) |
| PUT | /api/employees/{id}/reset-password | إعادة تعيين كلمة المرور |

#### Attendance
| Method | Endpoint | المستخدم |
|--------|----------|----------|
| POST | /api/attendance | الموظف يسجل يوم |
| PUT | /api/attendance/{id} | تعديل سجل اليوم الحالي |
| GET | /api/attendance/{employeeId}/{year}/{month} | المدير أو الموظف لعرض السجلات |

#### Monthly Summary
| Method | Endpoint | الوصف |
|--------|----------|-------|
| GET | /api/summary/{employeeId}/{year}/{month} | جلب ملخص شهر |
| POST | /api/summary/recalculate/{employeeId}/{year}/{month} | إعادة حساب شهر كامل |

#### Admin Dashboard
| Method | Endpoint | الوصف |
|--------|----------|-------|
| GET | /api/dashboard/stats | إحصائيات عامة |
| GET | /api/dashboard/top-delays | ترتيب حسب التأخير |
| GET | /api/dashboard/top-commitment | ترتيب حسب الالتزام |

### 10. البنية المقترحة للمجلدات
- `DTO/` لنماذج النقل بين الطبقات.
- `IServices/` لتعريف واجهات الخدمات.
- `Services/` لتطبيق الخدمات.
- `Mapper/` لملفات التحويل بين Entities و DTOs.
- `Entities/` وتشمل `BaseEntity` (معرف Int) و `FullBaseEntity` (موروثة مع حقول التعقب).
- `Repositories/` و `Controllers/` (يتم إضافتها لاحقًا عند بناء النظام بالكامل).

هذه الوثيقة تمثل المصدر المرجعي المبدئي للفريق، ويمكن تطويرها وإصدار نسخ محدثة مع تقدم المشروع.

